function sc22mat(file)

% SC22MAT converts sc2 files to matfile
%
% 	  MTL2MAT(name_core) 
%	  name_core is name of mtlfile without extension (.sc2) and
%	  running index. The matlab-file will be named name_core.mat

% Klaus Hartung (hartung@aea.ruhr-uni-bochum.de)
% Lehrstuhl fuer allg. Elektrotechnik und Akustik
% Ruhr-Universitaet Bochum
% 44780 Bochum 
%
% Date: 26.09.95  
% Modified: 7.7.96 Klaus Hartung

% Calls		toolbox
%
% mtlrh		hartung/mtl
% sizeoffile	hartung/tools
% mtlrch	hartung/mtl

% index ele azi

%the following data are a copy of gaik.index
MAPWI=[...
0   -10.     0.;...  
1     0.     0.;...  
2    10.     0.;...  
3    20.     0.;...  
4    30.     0.;...  
5    40.     0.;...  
6    50.     0.;...  
7    60.     0.;...  
8    70.     0.;...  
9    80.     0.;... 
10    90.     0.;...
11     0.    15.;...
12    20.    15.;...
13    40.    15.;...
14    60.    15.;...
15   -10.    30.;... 
16     0.    30.;...
17    10.    30.;...
18    30.    30.;...
19    50.    30.;...
20     0.    45.;...
21    20.    45.;...
22    40.    45.;...
23    70.    45.;...
24   -10.    60.;...
25     0.    60.;...
26    10.    60.;... 
27    30.    60.;...
28    50.    60.;...
29     0.    75.;...
30    20.    75.;... 
31    40.    75.;...
32    60.    75.;...
33   -10.    90.;...
34     0.    90.;...
35    10.    90.;...
36    30.    90.;...
37    50.    90.;...
38    70.    90.;...
39    80.    90.;...
40     0.   105.;...
41    20.   105.;...
42    40.   105.;...
43   -10.   120.;...
44     0.   120.;...
45    10.   120.;...
46    30.   120.;...
47    50.   120.;...
48     0.   135.;...
49    20.   135.;...
50    40.   135.;...
51    60.   135.;...
52    70.   135.;...
53   -10.   150.;...
54     0.   150.;...
55    10.   150.;...
56    30.   150.;...
57    50.   150.;...
58     0.   165.;...
59    20.   165.;...
60    40.   165.;...
61   -10.   180.;...
62     0.   180.;...
63    10.   180.;...
64    20.   180.;...
65    30.   180.;...
66    40.   180.;...
67    50.   180.;...
68    60.   180.;...
69    70.   180.;...
70    80.   180.;...
71    90.   180.;...
72     0.   195.;...
73    20.   195.;...
74    40.   195.;...
75    60.   195.;... 
76   -10.   210.;...
77     0.   210.;...
78    10.   210.;...
79    30.   210.;...
80    50.   210.;...
81     0.   225.;...
82    20.   225.;...
83    40.   225.;...
84    70.   225.;...
85   -10.   240.;...
86     0.   240.;...
87    10.   240.;...
88    30.   240.;...
89    50.   240.;...
90     0.   255.;...
91    20.   255.;...
92    40.   255.;...
93    60.   255.;...
94   -10.   270.;...
95     0.   270.;...
96    10.   270.;...
97    30.   270.;...
98    50.   270.;...
99    70.   270.;...
100    80.   270.;...
101     0.   285.;...
102    20.   285.;...
103    40.   285.;...
104   -10.   300.;...
105     0.   300.;...
106    10.   300.;...
107    30.   300.;...
108    50.   300.;...
109     0.   315.;...
110    20.   315.;...
111    40.   315.;...
112    60.   315.;...
113    70.   315.;...
114   -10.   330.;...
115     0.   330.;...
116    10.   330.;...
117    30.   330.;...
118    50.   330.;...
119     0.   345.;...
120    20.   345.;...
121    40.   345.;...
];
MAPWI=MAPWI.';

disp('Reading channels. This will take a while...');

%ind_name= 'd:/hrtf/head/gaik.index';
%[fid, msg] = fopen(ind_name,'r');
%if (fid < 0) error(msg); end;
%line = fgetl(fid);

%while (~feof(fid))
%   line = fgetl(fid);
%    if (feof(fid)) break; end;
%    if (~isempty(line) & isstr(line))
%      line = fliplr(deblank(fliplr(line)));
%      if line(1) == '%' disp ('line ignored');
%       else  
%        resultline= sscanf(line, '%i %f %f');
%        index=[index resultline(1:3)];
%      end;
%    end;
%end;
%fclose(fid);
%MAP = index(2:3,:);

filename=[file '1.sc2'];


[comment1, filetype, info_blocks,...
 n_channels, day_of_date, month_of_date, year_of_date,...
 no_bl_per_chan, subject_no, ...
 subject_first_name, subject_last_name, ...
 n_lines, sampling_rate,...
 lo_cutoff, hi_cutoff, eff_s_to_n, no_of_aver, ... 
 no_of_qu_bits, chan_code, ampl_gain, ...
 max_ele, min_ele, status, res_type, res, ...
 channels_per_dir, map, comment2] = mtlrh(filename);

filesize=sizeoffile(filename);

n_lines_v = (filesize-256*info_blocks)/(n_channels*4*2);
N_LINES=n_lines;

N_CHANNELS=244;
HRTF_RAW = zeros(N_LINES/2+1,N_CHANNELS);
Fs = sampling_rate;
N_LINES = n_lines;
N_DIR = 122;
N_CHANNELS = n_channels; 

if (res_type~=5)
   disp('No direction information included in files.');
   disp('Assuming standard measurement order.');
   MAP=MAPWI(2:3,:);
end;

if (res_type==5) MAP=[]; end;

for n=1:N_DIR
   filename=[file int2str(n) '.sc2'];

  % load header information

   [comment1, filetype, info_blocks,...
    n_channels, day_of_date, month_of_date, year_of_date,...
    no_bl_per_chan, subject_no, ...
    subject_first_name, subject_last_name, ...
    n_lines, sampling_rate,...
    lo_cutoff, hi_cutoff, eff_s_to_n, no_of_aver, ... 
    no_of_qu_bits, chan_code, ampl_gain, ...
    max_ele, min_ele, status, res_type, res, ...
    channels_per_dir, map, comment2] = mtlrh(filename);

   clc;
   disp(['Merging direction ' num2str(n)  ' of ' num2str(N_DIR) '.']);
   HRTF_RAW(:,n*2-1)=mtlrch(filename,1);
   HRTF_RAW(:,n*2)  =mtlrch(filename,2);
   if (res_type==5)   MAP=[MAP; map]; end;

end;


% clear  filetype info_blocks n_channels first_line last_line n_directions sampling_rate;

% clear filename n 

disp('Saving data in *.mat file.');

eval(['save ' file ' Fs N_LINES N_DIR N_CHANNELS MAP HRTF_RAW']);

% end of sc22mat.m